```
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview
A lightweight, self-hosted EPUB/TXT reader web app that displays books one chapter at a time, optimized for copy-pasting to LLMs. The app has two main components:

1. **CLI (reader3.py)**: Processes EPUB/TXT files and stores them in a library format
2. **Web Server (server.py)**: Serves the library and reading interface using FastAPI

## Quick Start
```bash
# Install dependencies (uses uv)
uv install

# Process an EPUB book
uv run reader3.py book.epub

# Start the web server
uv run server.py
```

## Architecture
- **reader3.py**: Handles book processing (EPUB parsing, TXT splitting, HTML cleaning, metadata extraction)
- **server.py**: FastAPI web server with endpoints for library management, chapter reading, file uploads
- **templates/**: Jinja2 HTML templates (library.html, reader.html)
- **data/**: Processed book storage (generated by reader3.py)
- **books/**: Watch directory for automatic book ingestion

## Key Dependencies
- ebooklib: EPUB parsing
- beautifulsoup4: HTML cleaning
- charset-normalizer: TXT file encoding detection
- fastapi + uvicorn: Web server
- jinja2: HTML templating

## Commonly Used Commands
```bash
# Process EPUB with custom output dir
uv run reader3.py book.epub --library /custom/path

# Process TXT file
uv run reader3.py notes.txt

# Run server on custom port
PORT=8080 uv run server.py

# Run server with custom book upload dir
READER_UPLOAD_DIR=~/books uv run server.py
```

## Development Tips
- No external database; all library data is stored in pickle files in the `data/` directory
- Books dropped into the `books/` directory are automatically processed on server startup/library refresh
- The server uses `uvicorn` for ASGI serving, which auto-reloads on code changes by default
